# slider_operation
Implement automatic registration for Slide Block Verification Code.
实现领英的自动注册。
## 所用环境
python：2.7  
浏览器：chrome  
系统：win 10 , MS Office  
所用的库大部分都比较常用，如codecs，部分库可能需要单独安装，比如`cv2`与`selenium`  
## `selenium`的安装与使用：
###  `selenium`的安装：
先安装selenium库（pip或者conda install等方法），再下载chrome驱动，放入chrome安装目录（一般是`..\Google\Chrome\Application`)，注意驱动的版本要与浏览器相同（下附版本对照表），浏览器的版本可以在刚才的安装路径中看到一个文件夹的名称便是（一般为60.x-66.x），然后将该安装路径添加到系统变量的path中 ，重启机器。
##### 附chrome与驱动版本对照表：
chrome的版本一般显示为6x.x，但是驱动的版本不是与其相同，而是以以下方式对应：

|chromedriver版本  |支持的Chrome版本
| :-------------:|:-------------:|
|v2.37|	v64-66|
|v2.36|	v63-65|
|v2.35|	v62-64|
|v2.34|	v61-63|


常用的是这些，更多的对照可以看这个网页:https://blog.csdn.net/huilan_same/article/details/51896672   

驱动的下载官方网址是：[官方驱动网址](https://sites.google.com/a/chromium.org/chromedriver/downloads)，但是官方的这个网址需要翻墙，也可以在[驱动镜像网站](http://npm.taobao.org/mirrors/chromedriver/)这个镜像站下载。
###  `selenium`的使用：
安装`selenium`之后，可以运行以下代码进行尝试，若成功打开百度首页说明`selenium`库安装成功。
```
from selenium import webdriver

browser = webdriver.Chrome()

browser.get("http://www.baidu.com")
print(browser.page_source)
browser.close()
```
## 算法
### 问题细化
目标：实现滑块验证码的自动操作

具体需要解决的问题：
	1、找到缺口的位置
	2、模拟人的鼠标操作轨迹
### 距离度量方式
距离度量：
对于两张图片采用均值哈希算法计算其相似度。

均值哈希算法：
1) 缩放：图片缩放为8*8，保留结构，出去细节。
2) 灰度化：转换为256阶灰度图。
3) 求平均值：计算灰度图所有像素的平均值。
4) 比较：像素值大于平均值记作1，相反记作0，总共64位。
5) 生成hash：将上述步骤生成的1和0按顺序组合起来既是图片的指纹（hash）。顺序不固定。但是比较时候必须是相同的顺序。
6) 对比指纹：将两幅图的指纹对比，计算汉明距离，即两个64位的hash值有多少位是不一样的，不相同位数越少，图片越相似。
### 所采用的聚类方法
不能直接采用K-means的方法，因为在聚类之前并不知道共有多少张原图，因此无法确认K的取值。  
所采取的聚类方式为有阈值的均值聚类。其步骤为:
1）初始化：设定阈值𝜃，并从训练图片中选取一张作为第一个类的一张图片，并以其哈希值作为该类的平均哈希值。
2）从训练图片中取出一张图片并计算其哈希值，与已有的所有聚类的哈希值计算之间的海明距离，若低于设定的阈值，则将其放入该类，逐位计算该类的平均哈希值并更新作为本类的平均哈希值，之后结束该次循环。若直到最后都没有放入某一个类中的话，则将其设为一个新的类。
不断重复步骤2）便可以得到训练集的聚类，每个类中为原图时同一张图的带有缺口的图片。
### 图片处理方法
在一个聚类中，选取两个缺口位置在不同侧（左右侧）的图片，将图片中没有缺口的一侧切割出并保留，将两侧的图片合并便得到了原图。
之后便是确定哈希坐标。
将需要确定的图片计算平均哈希值，并与所有类的原图的平均哈希进行比较，将其归类于海明距离最近的类。
之后用该类的原图减去这张图片。
对相减得到的图片做灰度处理，最后再进行二值化处理，便得到了清晰的缺口的图片。之后按列遍历图片中的像素，选取第一列白色像素点的数量高于某个阈值的列，这一列便是缺口开始的x坐标。
### 模拟鼠标轨迹
获取多条（几十条即可）自己的移动滑块时的鼠标轨迹，将其分为多段，采用二次回归来得到每一段的拟合函数，总的鼠标的移动的趋势是先加速后减速的过程。
由前一步得到的缺口的位置可以得到总的位移值，用以上函数便可以得到一条鼠标的轨迹，之后可以加入随机抖动等进一步提高轨迹的可信度。
## 优势与不足
优势：
相对于由监督的学习方法，该方法不需要对训练集进行标记，而且稳定性较高。
由有缺口的图片得到原图，适用于几乎所有的滑块验证码的情况。且使用selenium框架可以很方便的移植到不同的平台。
在合适的参数的情况下可以得到很好的效果。

不足：
需要通过尝试得到聚类的阈值、选取缺口第一列的阈值等参数。
使用selenium，使得如果需要大量的访问尝试，请求频率较低。
